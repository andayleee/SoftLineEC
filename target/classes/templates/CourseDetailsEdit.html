<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" style="background-color: #FFFFFF">
<head>
  <title>SoftLineEC - учет курсов</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <link th:href="@{/css/main.css}" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body style="background-color: #FFFFFF">
<form th:action="${'/CreateNewCourse/details/edit'}" method="post">
  <div th:insert="blocks/header.html"/>
  <div th:insert="blocks/nav.html"/>
  <div class="divcousre">
    <div class="row">
      <div class="col">
        <button type="submit" class="btn" id="load-block">Добавить блок</button>
      </div>
      <div style="display: flex; align-items: end; justify-content: end;" class="col">
        <p class="blockView">Блоков: 0</p>
      </div>
    </div>
    <div id="container"/>
  </div>
    <button type="submit" class="btn" id="save-block">Сохранить</button>
</form>
<script>
  var blockNum = 0;
  document.getElementById("load-block").addEventListener("click", function() {
    $.get("/blockAddSample", {num: blockNum}, function(data) {
      if(blockNum<5) {
        $("#container").append(data);
        $(".block").each(function (index) {
          $(this).find(".block-num").text(index + 1);
          $(this).attr("data-block-num", index + 1);
          var col = index + 1;
          $(".col").each(function () {
            $(this).find(".blockView").text("Блоков: " + col);
            blockNum=col;
          });
        });
      }else {
        alert("Достигнуто максимальное количество блоков");
      }
    });
    $("#container").on("click", ".delete-block", function() {
      if(blockNum>1) {
        $(this).closest(".block").remove();
        $(".block").each(function (index) {
          $(this).find(".block-num").text(index + 1);
          $(this).attr("data-block-num", index + 1);
          var col = index + 1;
          $(".col").each(function () {
            $(this).find(".blockView").text("Блоков: " + col);
            blockNum = col;
          });
        });
      }else {
      }
    });
    document.getElementById("save-block").addEventListener("click", function() {
      var nameOfBlockValues = [];
      var descriptionValues = [];
      var durationValues = [];
      $('.block').each(function() {
        var value = $(this).find('input').val();
        nameOfBlockValues.push(value);
        var value1 = $(this).find('textarea').val();
        descriptionValues.push(value1);
        var value2 = $(this).find('.number').val();
        durationValues.push(value2);
      });
      console.log(nameOfBlockValues);
      console.log(descriptionValues);
      console.log(durationValues);
      $.ajax({
        url: '/blockAddSample',
        type: 'POST',
        data: {
          nameOfBlock: nameOfBlockValues,
          description: descriptionValues,
          duration: durationValues
        },
        success: function(data) {
          console.log(data);// Обработка ответа от сервера
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.error(textStatus, errorThrown);
        }
      });
    });
  });
</script>
</body>
</html>