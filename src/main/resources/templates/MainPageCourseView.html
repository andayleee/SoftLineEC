<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" style="background-color: #EBECF0">
<head>
  <title>SoftLineEC - просмотр курса</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link th:href="@{/css/main.css}" rel="stylesheet" />
  <link rel="shortcut icon" href="/images/slLogo.svg">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<style>
  p{
    text-align: left;
    font-size: calc(var(--index)/1.3);
  }
  .row{
    margin-bottom: 12px;
  }
  tr{
    text-align: center;
  }
  td{
    text-align: left;
  }
</style>
<body class="body">
<div th:insert="blocks/header.html"/>
<form th:each="el: ${Course}" th:object="${Course}" class="center" style="height: 100%">
<div style="margin: 0 5vw 0 5vw">
  <div class="boxes">
    <div border="0">
      <h2 th:text="${el.nameOfCourse}" th:id="${el.idCourse}"  class="nameOfCourse course-card" name="nameOfCourse" style="margin-top: 8vh"/>
    </div>
  </div>
    <div class="col-12" style="margin-top: 36px">
      <div class="row">
        <div class="col-3">
          <p>Описание</p>
        </div>
        <div class="col-9">
          <p class="description pCourse" th:text="${el.description}" name="description" required></p>
        </div>
      </div>
      <hr style="margin-bottom: 12px"/>
      <div class="row">
        <div class="col-3">
          <p>Ресурсы</p>
        </div>
        <div class="col-9">
          <p class="resources pCourse" th:text="${el.resources}"  name="resources"></p>
        </div>
      </div>
      <hr style="margin-bottom: 12px"/>
      <div class="row">
        <div class="col-3">
          <p>Цель</p>
        </div>
        <div class="col-9">
          <p class="pCourse goal" th:text="${el.goal}"  name="goal"></p>
        </div>
      </div>
      <hr style="margin-bottom: 12px"/>
      <div class="row">
        <div class="col-3">
          <p>Задачи</p>
        </div>
        <div class="col-9">
          <p class="pCourse tasks" th:text="${el.tasks}"  name="tasks" ></p>
        </div>
      </div>
      <hr style="margin-bottom: 12px"/>
      <div class="row">
        <div class="col-3">
          <p>Категории обучающихся</p>
        </div>
        <div class="col-9">
          <p th:text="${el.categoriesOfStudents}" class="categoriesOfStudents pCourse"  name="categoriesOfStudents" >
        </div>
      </div>
    </div>
  <h2 class="title12" style="margin-top: 8vh;display: none" id="tableLabel">Блоки, входящие в курс:</h2>
  <div style="margin-top: 2vh;display: none" id="blockTable"></div>
  <h2 class="title12" style="display: none; margin-top: 8vh" id="lectureLabel">Таблица лекций:</h2>
  <div style="margin: 2vh 0 2vh 0;display: none" id="lectureTable"></div>
  <div class="divspace"></div>
  <button type="button" id="studying" class="custom-btn btn-16" style="width: 100%; margin: auto">Приступить к изучению</button>
  <div class="divspace"></div>
</div>
</form>
<script type="text/javascript" th:src="@{js/app.js}" src="js/app.js"></script>
</body>

<script type="text/javascript" th:src="@{/js/textAreaResize.js}" src="/js/textAreaResize.js"></script>
<script src="https://unpkg.com/imask" type="text/javascript"></script> <!-- Подключаем плагин через CDN -->
<script type="text/javascript" th:src="@{/js/jquery.maskedinput.js}" src="/js/jquery.maskedinput.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script>
  const studyingButton = document.getElementById('studying');
  studyingButton.addEventListener('click', function(event) {
    let nameOfCourse = document.getElementsByClassName("nameOfCourse");
    for (let i = 0; i < nameOfCourse.length; i++) {
      var idCourse = nameOfCourse[i].id;
    }
    $.post("/create-users-courses", {idCourse: idCourse}, function (data) {
      if (data=="Успешное добавление курса"){
        window.location.href = "/passingTheCourse";
      }
      if (data=="Данный курс уже есть"){
        window.location.href = "/passingTheCourse";
      }
    });
  });
  $(document).ready(function() {
    $.ajax({
      type: "POST",
      url: "/check-blocks-main",
      success: function(blocks) {
        console.log(blocks);
        if (blocks.length > 0) {
          var element = document.getElementById("tableLabel");
          element.style.display = "block";
          var element2 = document.getElementById("blockTable");
          element2.style.display = "block";
          var table = "<table id='blockTableTable'><thead><tr><th>Название блока</th><th>Описание блока</th><th style='width: 5vw'>Всего часов</th></thead>";
          table += "<tbody>";
          let allDuration = 0;
          $.each(blocks, function(index, block) {
            table += '<tr id-data='+block.idBlock+'>';
            table += "<td>" + block.nameOfBlock + "</td>";
            table += "<td>" + block.description + "</td>";
            table += "<td style='text-align: center'>" + block.duration + "</td>";
            table += "</tr>";
            allDuration += parseInt(block.duration);
          });
          table += '<tr>';
          table += "<td>" + "</td>";
          table += "<td style='text-align: right; color: #d02d49'>" + "Итого часов:" + "</td>";
          table += "<td style='text-align: center; color: #d02d49'>" + allDuration + "</td>";
          table += "</tr>";
          table += "</tbody></table>";
          $("#blockTable").html(table);
        } else {
          $("#blockTable").html("Нет блоков в базе данных");
        }
      },
      error: function() {
        alert("Ошибка при загрузке данных");
      }
    });
  });
</script>
<div th:insert="blocks/footer.html"/>
</html>